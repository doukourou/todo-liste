<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        /* Réinitialisation et styles de base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* Navigation */
        nav {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 15px 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 30px;
            justify-content: center;
        }

        nav li a {
            text-decoration: none;
            color: #667eea;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            padding: 8px 15px;
            border-radius: 5px;
        }

        nav li a:hover {
            background-color: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        /* Main container */
        main {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        main h1 {
            text-align: center;
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 40px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Sections de boutons */
        label {
            display: block;
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-top: 25px;
            margin-bottom: 10px;
        }

        /* Boutons principaux */
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(-1px);
        }

        #ajout {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);
        }

        #ajout:hover {
            box-shadow: 0 6px 20px rgba(17, 153, 142, 0.6);
        }

        #listeALL {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin-bottom: 30px;
        }

        /* Zone d'affichage des tâches */
        #liste {
            margin-top: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        #liste a {
            display: block;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            text-decoration: none;
            color: #333;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
        }

        #liste a:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        #liste p {
            margin: 10px 0;
            font-size: 16px;
            line-height: 1.6;
        }

        #liste p:first-child {
            font-weight: 700;
            color: #667eea;
            font-size: 18px;
        }

        /* Boutons dans les tâches */
        #liste button {
            margin-top: 15px;
            margin-right: 10px;
            padding: 8px 20px;
            font-size: 14px;
        }

        #liste button:first-of-type {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
        }

        #liste button:first-of-type:hover {
            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.6);
        }

        .btn-supprimer {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            box-shadow: 0 4px 15px rgba(250, 112, 154, 0.4);
        }

        .btn-supprimer:hover {
            box-shadow: 0 6px 20px rgba(250, 112, 154, 0.6);
        }

        /* Message quand il n'y a pas de tâches */
        #liste:empty::before {
            content: "Aucune tâche pour le moment. Cliquez sur 'Ajouter' pour créer votre première tâche !";
            display: block;
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 40px;
            background-color: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #ddd;
        }

        /* Responsive */
        @media (max-width: 768px) {
            main {
                padding: 20px;
            }

            main h1 {
                font-size: 2em;
            }

            nav ul {
                flex-direction: column;
                gap: 10px;
            }

            nav li a {
                display: block;
                text-align: center;
            }

            #liste button {
                display: block;
                width: 100%;
                margin-top: 10px;
                margin-right: 0;
            }
        }

        /* Animation d'apparition */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #liste a {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <nav><ul>
        <li><a href="enregistrement.html">inscription</a></li>
        <li><a href="conection.html">connection</a></li>
    </ul></nav>
    <main>
        <h1>todo list</h1>
        <label >Ajouter une tache</label>
        <button id="ajout">Ajouter</button>
        

        <label >Afficher toute les taches</label>
        <button id="listeALL">liste taches</button>
        <div id="liste"></div>

        
    </main>
    <script>
        // on vas rendre dinamique les bouttons 
        const ajouterBtn = document.getElementById('ajout');
        const listeALLBtn = document.getElementById('listeALL');
        const rechercherBtn = document.getElementById('rechercher');
        const modifierBtn = document.getElementById('modifier');
        const supprimerBtn = document.getElementById('supprimer');

        // apres les avoir recuperer on vas leur mettre un ecouteur d'evenement afin de leur ajouter un redirection vers les page que l'on souhaite
        ajouterBtn.addEventListener('click', ()=>{
            window.location.href = "ajout.html" //avec cette ligne si l'on clique sur le boutton ajouter on est rediriger vers la page d'age contenant le formulaire
            
        })
        const boite= document.getElementById('liste')
            // je place cette fonction en dehors d'un ecouteur d'evenement pour qu'elle soit accessible partout 
            function supprimerTache(id) {
                // Demander confirmation
                if (!confirm("Voulez-vous vraiment supprimer cette tâche ?")) {
                    return; // Si l'utilisateur annule, on arrête
                }
                
                const token = localStorage.getItem('token'); //la on recupere le token stoker dans le navigateur 
                // on fait notre appel en donnant les details 
                fetch(`http://localhost:3000/api/tache/supprimer/${id}`, {
                    method: "DELETE",
                    headers: {
                        "Authorization": `Bearer ${token}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Réponse:', data);
                    alert("Tâche supprimée avec succès");
                    window.location.reload(); // Recharge la page pour actualiser la liste
                })
                .catch(error => {
                    console.error("Erreur:", error);
                    alert("Erreur lors de la suppression");
                });
            }
        listeALLBtn.addEventListener('click', ()=>{
            // on vas recuperer le token envoyer
            const token = localStorage.getItem('token');
            // on vas  afficher toute les taches de l'utilisateur 
            fetch('http://localhost:3000/api/tache/liste', {
                method: "GET", //preciser la methode a appliquer a cette route
                headers: {
                    'Authorization': `Bearer ${token}`
                    // Devient: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                }}) // on utilise l'id de l'utilisateur pour recuperer ses tache
                    .then(reponse => reponse.json()) //la on recupere la reponse du sevreur 
                    .then(taches =>{
                        // on vas selection la boite dans laquel on veut afficher la liste 
                        boite.innerHTML = '';
                        // on vas maintenant afficher cette liste 
                        taches.forEach(tache => { //que tous les elemetn de la tache a soir l'id de la tache l'id de lutilisateur le nom et la description de la tache sont retourner on vas attribuer l'id de la tache au boutton modifier afin d'etre rediriger vers la page de modification et ceci permettra de modifier une autre tache 
                            // la on vas creer le boutton supprimer 
                            const btnsupp = document.createElement('button') //la on creer le boutton
                            btnsupp.textContent = 'Supprimer' //ici on y ajoute du texte
                            btnsupp.classList.add('btn-supprimer') //la on lui donne une classe 
                          
                            
                        //   apres avoir creer la fonction supprimer nous allons ajouter un ecouteur d'evenement au boutton
                            btnsupp.addEventListener('click', () => supprimerTache(tache._id));
                            boite.innerHTML += `
                            <a >
                                <p>Nom de la tache: ${tache.Nom}</p> 
                                <p>Description: ${tache.Description}</p>
                                <button onclick="window.location.href='modifier.html?id=${tache._id}'">Modifier</button> 
                                <button class="btn-supprimer" onclick="supprimerTache('${tache._id}')">Supprimer</button> 

                                
                            </a>
                            `
                        });
                })
                .catch(error => {
                    console.error("Erreur lors de la récupération des tâches:", error);
                })
        })
        
    </script>
</body>
</html>